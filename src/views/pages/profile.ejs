<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/profile.css" />
  </head>
  <body>
    <div class="profile-container">
      <!-- Header -->
      <header class="animated-header">
        <h1>GOOD DAY, USER1</h1>
        <p>
          <%= quote && quote.quote ? quote.quote : "Achieve your target." %>
        </p>
        <p style="margin-top: -25px">
          ~ <%= quote && quote.author ? quote.author : "Bob Hooey" %>
        </p>
      </header>

      <!-- Analytics Heading -->
      <h2 class="analytics-title"><%=currentMonth %> Analytics</h2>

      <!-- Cards -->
      <div class="cards animated-header">
        <div class="card gradient-green">
          <p>Today's Sale</p>
          <h3><%= cardInfo.todayLead %></h3>
        </div>
        <div class="card gradient-teal">
          <p>Month's Sale</p>
          <h3><%= cardInfo.totalSuccessLead %></h3>
        </div>
        <div class="card gradient-pink">
          <p>Gross Sales</p>
          <h3><%= cardInfo.totalLead %></h3>
        </div>
        <div class="card gradient-orange">
          <p>SPD</p>
          <h3><%= cardInfo.spd %></h3>
        </div>
        <div class="card gradient-blue">
          <p>Attendance</p>
          <h3><%= cardInfo.totalAttendance %></h3>
        </div>
        <div class="clear"></div>
      </div>

      <!-- Overview Section -->
      <div class="overview">
        <div class="overview-box box-1">
          <h3>MONTHLY ATTENDANCE OVERVIEW</h3>
          <div class="chart-placeholder">
            <div class="chart-wrap">
              <!-- fixed-size canvas helps old browsers handle layout reliably -->
              <canvas id="barChart" width="550" height="260"></canvas>
              <!-- <div id="legend" class="legend"></div> -->
            </div>
          </div>
        </div>
        <div class="overview-box box-2">
          <h3>LEADS OVERVIEW</h3>
          <div class="chart-placeholder">
            <canvas id="pieChart" width="350" height="250"></canvas>
            <!-- <div id="pieLegend" class="legend"></div> -->
          </div>
        </div>
        <div class="clear"></div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.1.1/Chart.min.js"></script>

    <script>
      var lateArray = <%- JSON.stringify(graphData?.lateArray)%>;
      var onTimeArray = <%- JSON.stringify(graphData?.ontimeArray)%>;

       var data = {
           labels: [
               "Jan",
               "Feb",
               "Mar",
               "Apr",
               "May",
               "Jun",
               "Jul",
               "Aug",
               "Sep",
               "Oct",
               "Nov",
               "Dec",
           ],
           datasets: [
               {
                   label: "LATE",
                   fillColor: "rgba(255,0,0,0.25)",
                   strokeColor: "rgb(255,0,0)",
                   highlightFill: "rgba(255,0,0,0.65)",
                   highlightStroke: "rgba(255,0,0,0.65)",
                   data: lateArray,
               },
               {
                   label: "ON TIME",
                   fillColor: "rgba(172,225,175,0.75)",
                   strokeColor: "rgba(172,225,175,1)",
                   highlightFill: "rgba(172,225,175,1)",
                   highlightStroke: "rgba(172,225,175,1)",
                   data: onTimeArray,
               },
           ],
       };

       // Chart options (v1.x)
       var options = {
           // keep animations conservative for very old browsers
           animation: true,
           animationSteps: 30,
           // display scale and grid lines
           scaleShowGridLines: true,
           // scaleGridLineColor: "rgba(0,0,0,.05)",
           scaleGridLineWidth: 1,
           barShowStroke: true,
           barStrokeWidth: 1,
           // spacing
           barValueSpacing: 5,
           barDatasetSpacing: 2,
           // tooltip fallback: Chart.js v1 has built-in tooltips; they should work
           // responsive: avoid enabling responsive resizing which can cause layout issues in very old engines
           responsive: false,
       };

       // Draw the chart (ES5 style)
       (function () {
           var ctx = document.getElementById("barChart").getContext("2d");
           // v1.x syntax creates a Chart instance and calls Bar
           var chart = new Chart(ctx).Bar(data, options);

           // build a simple legend (v1 didn't include a legend DOM by default)
           function buildLegend(datasets) {
               var html = [];
               for (var i = 0; i < datasets.length; i++) {
                   var ds = datasets[i];
                   html.push(
                       '<span style="display:inline-block;margin:0 8px;">' +
                           '<span style="display:inline-block;width:12px;height:12px;background:' +
                           ds.fillColor +
                           ";border:1px solid " +
                           ds.strokeColor +
                           ';margin-right:6px;vertical-align:middle;"></span>' +
                           '<span style="vertical-align:middle;">' +
                           (ds.label || "Series " + (i + 1)) +
                           "</span>" +
                           "</span>"
                   );
               }
               return html.join("");
           }

           var legendEl = document.getElementById("legend");
           if (legendEl) {
               legendEl.innerHTML = buildLegend(data.datasets);
           }
       })();
    </script>

    <!-- PIE -->

    <script>
                  // Pie chart data format in Chart.js v1.x

                  var pieChartData = <%- JSON.stringify(pieChart)%>;
                  console.log("pieChartData:", pieChartData);


                   var returnColors = function(status){
                      switch (status) {
                          case "pending":
                              return "#FFFE71";
                          case "success":
                              return "#ACE1AF";
                          case "cancelled":
                              return "#C81D11";
                          case "rework/warmup":
                              return "#0070BB";
                          default:
                              return "";
                      }
      };

                  var pieData = pieChartData.map(item=>(
                      {
                          value: item.count,
                          color: returnColors(item.status),
                          label: item.status.toUpperCase(),
                      }
                  ))


                  var pieOptions = {
                      animation: true,
                      animationSteps: 12,
                      segmentShowStroke: true,
                      duration: 15000, // 1.5 seconds
                      easing: "ease",
                      segmentStrokeColor: "#fff",
                      segmentStrokeWidth: 2,
                      percentageInnerCutout: 60,
                       // 0 = Pie, >0 = Doughnut
                      // animateRotate: true,
                      animateScale: true,
                      responsive: false,
                  };

                  // Draw the chart
                  (function () {
                      var ctx = document.getElementById("pieChart").getContext("2d");
                      var myPie = new Chart(ctx).Pie(pieData, pieOptions);

                      // Simple legend builder
                      function buildLegend(data) {
                          var html = [];
                          for (var i = 0; i < data.length; i++) {
                              var item = data[i];
                              html.push(
                                  '<span style="display:inline-block;margin:0 8px;">' +
                                      '<span style="display:inline-block;width:12px;height:12px;background:' +
                                      item.color +
                                      ';margin-right:6px;vertical-align:middle;"></span>' +
                                      '<span style="vertical-align:middle;">' +
                                      (item.label || "Slice " + (i + 1)) +
                                      "</span>" +
                                      "</span>"
                              );
                          }
                          return html.join("");
                      }

                      var legendEl = document.getElementById("pieLegend");
                      if (legendEl) {
                          legendEl.innerHTML = buildLegend(pieData);
                      }
                  })();
    </script>
  </body>
</html>
